# 実装要素一覧

rpg-coreライブラリで実装する要素をまとめたドキュメント

## ライブラリの方針

このライブラリは**汎用的な仕組み**のみを提供します。具体的なゲームの詳細（スキルの種類、アイテムの効果、ステータスの計算式など）は、ゲームを作る人が自由に実装できるように設計します。

- ✅ 提供するもの：フレームワーク、基本構造、インターフェース、汎用的な処理フロー
- ❌ 提供しないもの：具体的なゲームルール、固定のステータス種類、特定のスキル実装

## 目次

1. [キャラクター管理](#キャラクター管理)
2. [ジョブシステム](#ジョブシステム)
3. [装備システム](#装備システム)
4. [スキル](#スキル)
5. [アビリティシステム](#アビリティシステム)
6. [アイテム管理](#アイテム管理)
7. [アイテム合成システム](#アイテム合成システム)
8. [戦闘システム](#戦闘システム)

---

## キャラクター管理

### 概要
キャラクターエンティティを管理する汎用的な仕組み

### 提供する仕組み
- **キャラクターの抽象クラス/インターフェース**
  - カスタマイズ可能なプロパティを持てる構造
  - ゲーム開発者が自由に拡張できる設計
  - ジェネリクス型による型安全な実装
- **キャラクターのライフサイクル管理**
  - 作成、取得、更新、削除のメソッド
  - ID管理の仕組み
- **ステータス管理システム**
  - `CharacterStatus`型をジェネリクスで定義
  - キー・バリューペアでの柔軟なステータス管理
  - 数値型、文字列型など複数の型に対応
  - 基礎値と補正値を分離して管理
  - 複数の補正を適用できる仕組み（加算、乗算、優先度）
  - 最大値・現在値の管理（HP、MPなど）
- **経験値・レベルシステム**
  - 経験値の取得・管理
  - レベルアップの検知と処理
  - カスタマイズ可能なレベルアップ条件
  - 必要経験値の計算フレームワーク
- **レベルによるステータス変化**
  - レベルアップ時のステータス成長フレームワーク
  - 成長パターンの定義（固定値、成長率、カーブなど）
  - カスタム成長ロジックの適用
- **状態管理**
  - キャラクターの状態（生存、死亡など）
  - 状態変更の通知システム
- **イベントシステム**
  - レベルアップイベント
  - ステータス変更イベント
  - カスタムイベントの定義

### ゲーム開発者が実装するもの
- **CharacterStatus型の定義**
  ```typescript
  // 例：開発者が定義するステータス型
  type MyGameStatus = {
    hp: number;
    maxHp: number;
    mp: number;
    maxMp: number;
    attack: number;
    defense: number;
    speed: number;
    // ... 任意のステータス
  };
  ```
- 具体的なキャラクタータイプ（戦士、魔法使いなど）
- キャラクター固有のプロパティ
- 種族やクラスの定義
- レベルアップに必要な経験値の計算式
- レベルアップ時のステータス成長計算
- 成長率や成長補正値
- レベルキャップ

---

## ジョブシステム

### 概要
キャラクターの職業・クラスを管理する汎用的な仕組み

### 提供する仕組み
- **ジョブの抽象クラス/インターフェース**
  - ジョブIDと名前の管理
  - カスタムプロパティを持てる構造
- **ジョブの割り当てと変更**
  - キャラクターへのジョブ設定
  - ジョブ変更の仕組み
  - 複数ジョブの管理（マルチクラス対応）
- **ジョブ固有の能力補正**
  - パラメータへの補正適用の仕組み
  - ジョブによる制約の管理
- **ジョブによる装備制限**
  - 装備可能な装備タイプの制限
  - ジョブと装備の互換性チェックの仕組み
- **ジョブレベル/熟練度システム**
  - ジョブごとの経験値・レベル管理
  - 成長の追跡

### ゲーム開発者が実装するもの
- 具体的なジョブの種類（戦士、魔法使い、僧侶など）
- ジョブごとのパラメータ補正値
- ジョブの成長率
- ジョブ固有のスキル習得条件
- ジョブチェンジの条件
- ジョブごとの装備制限ルール（戦士は剣・斧が装備可能、魔法使いは杖のみなど）

---

## 装備システム

### 概要
キャラクターの装備品を管理する汎用的な仕組み

### 提供する仕組み
- **装備品の抽象クラス/インターフェース**
  - 装備IDと名前の管理
  - カスタムプロパティを持てる構造
- **装備スロット管理**
  - 柔軟な装備スロットの定義
  - スロットタイプと装備タイプのマッピング
- **装備の着脱**
  - 装備/解除のメソッド
  - 装備条件の判定フレームワーク
  - ジョブによる装備制限のチェック
- **装備効果の適用**
  - パラメータ補正の適用/解除
  - 複数の装備効果の統合
- **装備セット管理**
  - 現在の装備構成の取得
  - 装備の一括変更

### ゲーム開発者が実装するもの
- 具体的な装備品（剣、盾、鎧など）
- 装備スロットの種類（武器、防具、アクセサリーなど）
- 装備のステータス補正値
- 装備条件（レベル、ジョブ制限など）
- 装備の特殊効果

---

## スキル

### 概要
キャラクターが使用できる技・魔法を管理する汎用的な仕組み

### 提供する仕組み
- **スキルの抽象クラス/インターフェース**
  - スキルIDと名前の管理
  - カスタムプロパティを持てる構造
- **スキル実行フレームワーク**
  - スキル使用の前提条件チェック
  - スキル実行のライフサイクル（発動前→実行→効果適用→発動後）
  - 対象選択の仕組み
- **スキル効果システム**
  - エフェクトの抽象化（ダメージ、回復、補正など）
  - 複数エフェクトの組み合わせ
  - エフェクトの適用順序管理
- **スキル習得管理**
  - キャラクターが習得したスキルの管理
  - スキル習得/忘却のメソッド
- **コスト管理**
  - MPやその他リソースの消費管理
  - カスタムコストの定義

### ゲーム開発者が実装するもの
- 具体的なスキル（ファイア、ヒール、剣技など）
- スキルの効果内容
- スキルの対象範囲（単体、全体、範囲など）
- スキルのコスト
- スキル習得条件
- ダメージや回復の計算式

---

## アビリティシステム

### 概要
キャラクターの常時発動型・パッシブな能力を管理する汎用的な仕組み

### 提供する仕組み
- **アビリティの抽象クラス/インターフェース**
  - アビリティIDと名前の管理
  - カスタムプロパティを持てる構造
  - アビリティタイプの定義（パッシブ/トリガー型）
- **アビリティ効果システム**
  - 常時効果の適用（パラメータ補正、特殊能力など）
  - 条件付き発動の仕組み（HPが一定以下で発動など）
  - トリガーベースの効果（攻撃時、被ダメージ時など）
- **アビリティ習得管理**
  - キャラクターが習得したアビリティの管理
  - アビリティの装備/解除（装備可能数の制限）
  - アビリティポイント/スロットシステム
- **アビリティの有効化/無効化**
  - アビリティのオン/オフ切り替え
  - 条件による自動有効化
- **アビリティの優先度管理**
  - 複数アビリティの効果適用順序
  - 競合解決の仕組み

### ゲーム開発者が実装するもの
- 具体的なアビリティ（二刀流、カウンター、自動回復など）
- アビリティの効果内容
- アビリティの発動条件
- アビリティ習得条件
- アビリティのコスト（装備に必要なポイントなど）
- アビリティ同士の相互作用

---

## アイテム管理

### 概要
アイテムとインベントリを管理する汎用的な仕組み

### 提供する仕組み
- **アイテムの抽象クラス/インターフェース**
  - アイテムIDと名前の管理
  - カスタムプロパティを持てる構造
  - スタック可能/不可可能の設定
- **インベントリシステム**
  - アイテムの追加/削除
  - アイテム数の管理
  - インベントリ容量の制限
  - アイテムの検索・フィルタリング
  - アイテムのソート機能
- **アイテム使用フレームワーク**
  - アイテム使用の前提条件チェック
  - アイテム効果の適用
  - 使用後の処理（消費、数量減少など）
- **アイテム分類**
  - カテゴリーによる分類
  - タグによる柔軟な分類

### ゲーム開発者が実装するもの
- 具体的なアイテム（ポーション、エリクサー、鍵など）
- アイテムの効果内容
- アイテムの使用条件
- アイテムの価格
- アイテムのレアリティ

---

## アイテム合成システム

### 概要
複数のアイテムを組み合わせて新しいアイテムを生成する汎用的な仕組み

### 提供する仕組み
- **レシピ管理**
  - レシピの抽象クラス/インターフェース
  - 必要素材の定義（アイテムIDと数量）
  - 生成されるアイテムの定義
  - レシピの有効化/無効化
- **合成実行システム**
  - 素材の所持チェック
  - 合成条件の検証
  - 合成の実行と素材消費
  - 結果アイテムの生成
- **合成成功率システム**
  - 成功/失敗の判定フレームワーク
  - 確率計算の仕組み
  - 失敗時の処理（素材消失、一部返却など）
- **レシピ発見システム**
  - レシピの習得管理
  - レシピの表示/非表示
  - 未発見レシピの扱い
- **合成コスト管理**
  - 合成に必要な追加リソース（お金、MPなど）
  - カスタムコストの定義
- **高度な合成オプション**
  - 触媒アイテムの使用
  - 品質値の管理
  - ランダム要素の組み込み

### ゲーム開発者が実装するもの
- 具体的なレシピ（ポーション調合、武器強化など）
- 必要素材と数量
- 合成結果のアイテム
- 合成成功率の計算式
- レシピ習得条件
- 合成時の特殊効果
- 失敗時のペナルティ

---

## 戦闘システム

### 概要
ターン制戦闘を管理する汎用的な仕組み

### 提供する仕組み
- **バトル管理**
  - バトルの開始/終了
  - バトル状態の管理（進行中、終了など）
  - 勝利/敗北条件の判定フレームワーク
- **ターン管理**
  - ターンの進行制御
  - 行動順の決定と管理
  - カスタム行動順アルゴリズムの適用
- **行動システム**
  - 行動の抽象クラス（攻撃、防御、スキル、アイテム使用など）
  - 行動キューの管理
  - 行動の実行フレームワーク
- **戦闘参加者管理**
  - 味方グループと敵グループの管理
  - ターゲット選択の仕組み
  - グループ内のキャラクター管理
- **ダメージ計算フレームワーク**
  - ダメージ計算のパイプライン
  - 複数の計算ステップ（基礎ダメージ→補正→最終ダメージ）
  - クリティカルや命中判定の仕組み
- **イベントシステム**
  - バトルイベントの通知（ダメージ発生、ターン開始など）
  - カスタムイベントハンドラの登録
- **効果管理**
  - バフ/デバフの適用と管理
  - 持続ターンの管理
  - 効果の累積と上書きルール

### ゲーム開発者が実装するもの
- 具体的なバトルルール
- ダメージ計算式
- クリティカル判定の計算
- 命中・回避の計算
- 行動順の決定ロジック
- 敵のAI
- 勝利条件・敗北条件
- 報酬の配布ロジック

---

## 実装優先度

### フェーズ1：基礎システム
1. キャラクター管理
2. ジョブシステム
3. 戦闘システムの基礎（バトル管理、ターン管理）

### フェーズ2：戦闘関連機能
1. スキル
2. アビリティシステム
3. 戦闘システムの拡張（ダメージ計算、効果管理）

### フェーズ3：アイテム関連機能
1. アイテム管理
2. 装備システム
3. アイテム合成システム

### フェーズ4：拡張・最適化
1. 高度な戦闘機能
2. パフォーマンス最適化
3. 追加機能の実装

---

## 技術的考慮事項

### アーキテクチャ
- TypeScriptでの実装
- オブジェクト指向設計とインターフェースの活用
- ジェネリクスによる型安全性の確保
- 拡張性を重視した設計パターン

### テスト
- ユニットテストの実装
- 統合テストによる機能連携の検証
- エッジケースのテスト

### 拡張性
- プラグインシステムの考慮
- カスタマイズ可能な設定
- モジュール化された設計
- イベント駆動型アーキテクチャ

### パフォーマンス
- 効率的なデータ構造の選択
- 不要な計算の削減
- キャッシュの活用

---

## まとめ

このドキュメントでは、rpg-coreライブラリで実装すべき8つの主要システムを定義しました。

### 設計の基本方針
1. **汎用性**: 具体的なゲームルールを実装せず、フレームワークのみを提供
2. **拡張性**: ゲーム開発者が自由にカスタマイズできる構造
3. **型安全性**: TypeScriptの型システムを最大限活用
4. **モジュール性**: 各システムが独立しながらも連携できる設計

### 各システムの関係
- **キャラクター管理**は全てのシステムの基盤
- **ジョブシステム**と**アビリティシステム**がキャラクターの能力を定義
- **装備システム**と**アイテム管理**がキャラクターの持ち物を管理
- **スキル**と**戦闘システム**がゲームプレイの中核
- **アイテム合成システム**がゲームの深みを追加

実装は優先度に従って段階的に進め、各フェーズで動作確認を行うことを推奨します。

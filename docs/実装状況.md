# 実装状況トラッキング

rpg-coreライブラリの各機能の実装状況を追跡するドキュメント

最終更新: 2026-01-12

## Phase 1完了: カスタマイズ可能な型システム + 型の一元管理

**実装完了:**
- ✅ Stats（ステータス）- ジェネリック対応
- ✅ StatusEffect（状態異常）- ジェネリック対応  
- ✅ Element（属性）- ジェネリック対応
- ✅ SkillType（スキルタイプ）- ジェネリック対応
- ✅ TargetType（対象タイプ）- ジェネリック対応
- ✅ ExpCurveType（経験値曲線）- ジェネリック対応
- ✅ **GameTypeConfig** - 型の一元管理システム 🆕

**メリット:**
- ゲームジャンルに応じた独自の型定義が可能
- 型安全性を保ちながら柔軟な設計を実現
- 完全な後方互換性を維持
- **GameTypeConfigで型パラメータの重複を排除** 🆕
- **プロジェクト全体で一貫した型を使用可能** 🆕

## 実装ステータスの定義

- 🔴 **未着手**: 実装が開始されていない
- 🟡 **進行中**: 実装作業が進行中
- 🟢 **完了**: 実装が完了し、動作する
- ✅ **テスト済み**: 単体テストおよび統合テストが完了

## Core Engine層の実装状況

### 型システム (types/)
| モジュール | ステータス | 実装ファイル | テスト | 備考 |
|-----------|----------|------------|-------|------|
| 基本型 | ✅ **テスト済み** | src/types/common.ts | - | UniqueId, Probability等 |
| 属性型 | ✅ **完了** | src/types/common.ts | - | **ジェネリック対応**<br/>BaseElement/DefaultElement導入 |
| ステータス型 | ✅ **完了** | src/types/stats.ts | - | **ジェネリック対応**<br/>BaseStats/DefaultStats導入 |
| 状態異常型 | ✅ **完了** | src/types/statusEffect.ts | - | **ジェネリック対応**<br/>BaseStatusEffectType/Category導入 |
| スキル型 | ✅ **完了** | src/types/skill.ts | - | **ジェネリック対応**<br/>BaseSkillType/TargetType導入<br/>4つのジェネリック型をサポート |
| 戦闘者型 | ✅ **完了** | src/types/combatant.ts | - | **ジェネリック対応**<br/>3つのジェネリック型をサポート |
| 設定型 | ✅ **完了** | src/types/config.ts | - | **ジェネリック対応**<br/>BaseExpCurveType/DefaultExpCurveType導入 |
| **型の一元管理** | ✅ **完了** | src/types/gameTypes.ts | - | **GameTypeConfig導入** 🆕<br/>型パラメータの重複を排除<br/>プロジェクト全体で一貫した型を使用可能 |

### 戦闘システム (combat/)
| モジュール | ステータス | 実装ファイル | テスト | 備考 |
|-----------|----------|------------|-------|------|
| ダメージ計算 | ✅ **テスト済み** | src/combat/damage.ts | tests/combat/damage.test.ts | 物理・魔法ダメージ計算、回復計算 |
| 命中判定 | ✅ **テスト済み** | src/combat/accuracy.ts | tests/combat/accuracy.test.ts | 命中率・回避率の計算 |
| クリティカル判定 | ✅ **テスト済み** | src/combat/accuracy.ts | tests/combat/accuracy.test.ts | クリティカル発生判定 |
| 行動順計算 | ✅ **テスト済み** | src/combat/turnOrder.ts | tests/combat/turnOrder.test.ts | 素早さベースの行動順、速度分散 |
| 先制攻撃判定 | ✅ **テスト済み** | src/combat/turnOrder.ts | tests/combat/turnOrder.test.ts | パーティ速度差による先制判定 |
| 勝敗判定 | 🔴 未着手 | - | - | 勝利・敗北条件の判定 |
| 逃走判定 | 🔴 未着手 | - | - | 逃走成功率の計算 |

### キャラクター管理 (character/)
| モジュール | ステータス | 実装ファイル | テスト | 備考 |
|-----------|----------|------------|-------|------|
| ステータス計算 | ✅ **テスト済み** | src/character/stats.ts | tests/character/stats.test.ts | 最終ステータスの算出、修飾子適用<br/>**ジェネリック対応でカスタムステータスをサポート** |
| レベルアップ | 🔴 未着手 | - | - | 経験値とレベル管理 |
| 成長計算 | 🔴 未着手 | - | - | ステータス成長の計算 |
| スキル管理 | 🔴 未着手 | - | - | スキル習得判定 |
| ジョブ管理 | 🔴 未着手 | - | - | 転職条件とステータス |

### 状態異常 (statusEffect/)
| モジュール | ステータス | 実装ファイル | テスト | 備考 |
|-----------|----------|------------|-------|------|
| 状態異常型定義 | ✅ **完了** | src/types/statusEffect.ts | - | **ジェネリック対応でカスタム状態異常をサポート**<br/>BaseStatusEffectType/Category導入 |
| 状態異常処理 | 🔴 未着手 | - | - | 状態異常の適用・解除ロジック |
| 状態異常効果 | 🔴 未着手 | - | - | ターン毎の効果発動 |

### アイテム管理 (item/)
| モジュール | ステータス | 実装ファイル | テスト | 備考 |
|-----------|----------|------------|-------|------|
| インベントリ | 🔴 未着手 | - | - | アイテム追加・削除 |
| アイテム効果 | 🔴 未着手 | - | - | 使用可否と効果計算 |
| 装備管理 | 🔴 未着手 | - | - | 装備可否判定 |
| 装備ボーナス | 🔴 未着手 | - | - | 装備によるステータス補正 |

### クラフト・強化 (craft/)
| モジュール | ステータス | 実装ファイル | テスト | 備考 |
|-----------|----------|------------|-------|------|
| 合成システム | 🔴 未着手 | - | - | レシピと素材チェック |
| 成功率計算 | 🔴 未着手 | - | - | 合成成功判定 |
| 強化システム | 🔴 未着手 | - | - | 強化レベルと成功率 |
| レシピ管理 | 🔴 未着手 | - | - | レシピ解放条件 |

### 敵・AI (enemy/)
| モジュール | ステータス | 実装ファイル | テスト | 備考 |
|-----------|----------|------------|-------|------|
| 敵ステータス生成 | 🔴 未着手 | - | - | レベルベースの生成 |
| AI評価 | 🔴 未着手 | - | - | スキル・ターゲット評価 |
| ドロップ判定 | 🔴 未着手 | - | - | アイテムドロップ計算 |
| 報酬計算 | 🔴 未着手 | - | - | 経験値・お金の計算 |

### 状態異常 (status/)
| モジュール | ステータス | 実装ファイル | テスト | 備考 |
|-----------|----------|------------|-------|------|
| 付与判定 | 🔴 未着手 | - | - | 耐性と成功率 |
| 効果計算 | 🔴 未着手 | - | - | 継続ダメージ等 |
| 持続時間管理 | 🔴 未着手 | - | - | ターン経過処理 |
| 行動制限 | 🔴 未着手 | - | - | 行動不能判定 |

### パーティ管理 (party/)
| モジュール | ステータス | 実装ファイル | テスト | 備考 |
|-----------|----------|------------|-------|------|
| 編成検証 | 🔴 未着手 | - | - | 人数制限等 |
| 隊列管理 | 🔴 未着手 | - | - | 前列・後列 |

---

## Service層の実装状況

### 戦闘・操作
| Service | ステータス | 実装ファイル | テスト | 備考 |
|---------|----------|------------|-------|------|
| BattleService | ✅ **テスト済み** | src/services/BattleService.ts | tests/services/BattleService.test.ts | 戦闘全体の進行管理 |
| CommandService | ✅ **テスト済み** | src/services/CommandService.ts | tests/services/CommandService.test.ts | コマンド選択フロー |
| ItemService | 🔴 未着手 | - | - | アイテム使用フロー |

### 敵
| Service | ステータス | 実装ファイル | テスト | 備考 |
|---------|----------|------------|-------|------|
| EnemyAIService | ✅ **テスト済み** | src/services/EnemyAIService.ts | tests/services/EnemyAIService.test.ts | 敵の行動決定 |
| EnemyGroupService | ✅ **テスト済み** | src/services/EnemyGroupService.ts | tests/services/EnemyGroupService.test.ts | 敵グループ管理 |

### 成長・キャラクター
| Service | ステータス | 実装ファイル | テスト | 備考 |
|---------|----------|------------|-------|------|
| SkillLearnService | 🔴 未着手 | - | - | スキル習得管理 |
| JobChangeService | 🔴 未着手 | - | - | 職業変更管理 |
| RewardService | 🔴 未着手 | - | - | 報酬処理 |

### 管理・編成
| Service | ステータス | 実装ファイル | テスト | 備考 |
|---------|----------|------------|-------|------|
| InventoryService | 🔴 未着手 | - | - | インベントリ管理 |
| EquipmentService | 🔴 未着手 | - | - | 装備変更管理 |
| PartyService | 🔴 未着手 | - | - | パーティ編成管理 |
| StatusEffectService | 🔴 未着手 | - | - | 状態異常管理 |

### クラフト・育成
| Service | ステータス | 実装ファイル | テスト | 備考 |
|---------|----------|------------|-------|------|
| CraftService | 🔴 未着手 | - | - | アイテム合成管理 |
| EnhanceService | 🔴 未着手 | - | - | 強化管理 |

### システム・支援
| Service | ステータス | 実装ファイル | テスト | 備考 |
|---------|----------|------------|-------|------|
| SaveLoadService | 🔴 未着手 | - | - | セーブ/ロード管理 |
| SimulationService | 🔴 未着手 | - | - | 戦闘シミュレーション |

---

## Headless UI層の実装状況

| Controller | ステータス | 実装ファイル | テスト | 備考 |
|-----------|----------|------------|-------|------|
| BattleController | 🔴 未着手 | - | - | 戦闘UI状態管理 |
| CommandController | 🔴 未着手 | - | - | コマンド選択UI |
| ItemController | 🔴 未着手 | - | - | アイテム使用UI |
| EquipmentController | 🔴 未着手 | - | - | 装備変更UI |
| PartyController | 🔴 未着手 | - | - | パーティ編成UI |
| CraftController | 🔴 未着手 | - | - | クラフトUI |

---

## 実装フェーズと進捗

### フェーズ1: Core Engine基礎 + Service層基礎 (進捗: ✅ **完了**)
**Core Engine実装完了:**
- [x] combat/damage - ダメージ計算（物理・魔法・回復）
- [x] combat/accuracy - 命中判定・クリティカル判定
- [x] combat/turnOrder - 行動順計算・先制攻撃判定
- [x] character/stats - ステータス計算・修飾子適用
- [x] 型定義システム - 完全な型定義
- [x] デフォルト設定 - ゲーム設定

**Service層実装完了:**
- [x] BattleService - 戦闘全体の進行管理
- [x] CommandService - コマンド選択
- [x] EnemyAIService - 敵の行動決定
- [x] EnemyGroupService - 敵グループ管理

**テスト状況:**
- 157個のテスト、すべて合格
- コードカバレッジ: 85.36%
- TDD手法で開発

### フェーズ2: 成長と管理 (進捗: 0/4)
- [ ] RewardService - 報酬処理
- [ ] EquipmentService - 装備変更
- [ ] PartyService - パーティ編成
- [ ] StatusEffectService - 状態異常管理

**必要なCore Engine**:
- character/growth (成長計算)
- item/equipment (装備管理)
- status/effects (状態異常)
- party/formation (編成管理)

### フェーズ3: 発展的な機能 (進捗: 0/3)
- [ ] SkillLearnService - スキル習得
- [ ] JobChangeService - 職業変更
- [ ] ItemService - アイテム使用

**必要なCore Engine**:
- character/skill (スキル管理)
- character/job (ジョブ管理)
- item/effects (アイテム効果)

### フェーズ4: 拡張機能 (進捗: 0/4)
- [ ] CraftService - アイテム合成
- [ ] EnhanceService - 強化
- [ ] SaveLoadService - セーブ/ロード
- [ ] SimulationService - シミュレーション

**必要なCore Engine**:
- craft/synthesis (合成)
- craft/enhance (強化)

---

## 次のステップ

### 即座に着手すべき項目
1. **フェーズ1のCore Engine実装**
   - combat/damage モジュール
   - combat/turnOrder モジュール
   - enemy/ai モジュール

2. **フェーズ1のService実装**
   - BattleService の基本実装
   - テストの作成

3. **型定義の整備**
   - Character, Enemy, Skill などの基本型
   - BattleState などの状態型

### 実装のマイルストーン

- **M1 (基礎)**: Core Engine基本型定義 + combat基本機能
- **M2 (戦闘)**: BattleService + CommandService実装
- **M3 (敵AI)**: EnemyAIService実装
- **M4 (統合)**: フェーズ1の統合テスト完了

---

## 更新履歴

- 2026-01-11: 初版作成、全機能の実装状況をトラッキング開始

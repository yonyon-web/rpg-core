---
import DocsLayout from '../../layouts/DocsLayout.astro';

const baseUrl = import.meta.env.BASE_URL.endsWith('/') ? import.meta.env.BASE_URL : `${import.meta.env.BASE_URL}/`;

const sidebarLinks = [
  { href: '#overview', text: 'æ©Ÿèƒ½ã®æ¦‚è¦', active: true },
  { href: '#headless-ui', text: 'Headless UI' },
  { href: '#service', text: 'Service' },
  { href: '#core-engine', text: 'Core Engine' }
];

const relatedLinks = [
  { href: `${baseUrl}docs/`, text: 'â† ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆTOP' },
  { href: `${baseUrl}docs/item/`, text: 'ã‚¢ã‚¤ãƒ†ãƒ  â†’' }
];
---

<DocsLayout 
  title="æˆ¦é—˜ã‚·ã‚¹ãƒ†ãƒ " 
  sidebarTitle="æˆ¦é—˜ã‚·ã‚¹ãƒ†ãƒ "
  sidebarLinks={sidebarLinks}
  relatedLinks={relatedLinks}
>
    <h1 id="overview">æˆ¦é—˜ã‚·ã‚¹ãƒ†ãƒ </h1>
    
    <h2>æ©Ÿèƒ½ã®æ¦‚è¦</h2>
    <p>
        æˆ¦é—˜ã‚·ã‚¹ãƒ†ãƒ ã¯ã€ã‚¿ãƒ¼ãƒ³åˆ¶ãƒãƒˆãƒ«ã®é€²è¡Œã‚’ç®¡ç†ã™ã‚‹æ©Ÿèƒ½ã§ã™ã€‚
        ã‚³ãƒãƒ³ãƒ‰é¸æŠã€è¡Œå‹•å®Ÿè¡Œã€ãƒ€ãƒ¡ãƒ¼ã‚¸è¨ˆç®—ãªã©ã€æˆ¦é—˜ã«å¿…è¦ãªå…¨ã¦ã®æ©Ÿèƒ½ã‚’æä¾›ã—ã¾ã™ã€‚
    </p>

    <div class="card">
        <h3>ğŸ¯ ä¸»ãªæ©Ÿèƒ½</h3>
        <ul>
            <li><strong>ãƒ€ãƒ¡ãƒ¼ã‚¸è¨ˆç®—</strong>: ç‰©ç†æ”»æ’ƒã€é­”æ³•æ”»æ’ƒã€å›å¾©ãªã©ã®è¨ˆç®—</li>
            <li><strong>è¡Œå‹•é †ç®¡ç†</strong>: ç´ æ—©ã•ã«åŸºã¥ãè¡Œå‹•é †ã®æ±ºå®š</li>
            <li><strong>ã‚³ãƒãƒ³ãƒ‰é¸æŠ</strong>: ãƒ—ãƒ¬ã‚¤ãƒ¤ãƒ¼ã®æˆ¦é—˜ã‚³ãƒãƒ³ãƒ‰é¸æŠãƒ•ãƒ­ãƒ¼</li>
            <li><strong>å‹æ•—åˆ¤å®š</strong>: æˆ¦é—˜ã®å‹åˆ©ãƒ»æ•—åŒ—ãƒ»é€ƒèµ°ã®åˆ¤å®š</li>
        </ul>
    </div>

    <h2 id="headless-ui">Headless UI</h2>
    
    <h3>åŸºæœ¬çš„ãªä½¿ã„æ–¹</h3>
    <p>BattleControllerã‚’ä½¿ã£ã¦æˆ¦é—˜ã‚’ç®¡ç†ã™ã‚‹åŸºæœ¬çš„ãªä¾‹ã§ã™ï¼š</p>
    <pre><code>{`import { GEasyKit } from 'geasy-kit';

const game = new GEasyKit();
const battleController = game.controllers.battle();

// æˆ¦é—˜ã‚’é–‹å§‹
await battleController.startBattle(playerParty, enemyGroup);

// çŠ¶æ…‹ã‚’è³¼èª­
battleController.subscribe((state) => {
  console.log('ç¾åœ¨ã®ãƒ•ã‚§ãƒ¼ã‚º:', state.phase);
  console.log('ã‚¿ãƒ¼ãƒ³æ•°:', state.turnNumber);
  updateUI(state); // UIã‚’æ›´æ–°
});

// ã‚¤ãƒ™ãƒ³ãƒˆã‚’è³¼èª­
battleController.on('action-executed', (data) => {
  console.log('è¡Œå‹•å®Ÿè¡Œ:', data.action, data.result);
  showActionAnimation(data);
});

// ã‚³ãƒãƒ³ãƒ‰é¸æŠ
await battleController.selectCommand(playerId, {
  type: 'attack',
  targetId: enemyId
});

// ã‚¿ãƒ¼ãƒ³ã‚’å®Ÿè¡Œ
await battleController.executeTurn();`}</code></pre>

    <h3>ã‚¤ãƒ™ãƒ³ãƒˆä¸€è¦§</h3>
    <p><code>on()</code>ãƒ¡ã‚½ãƒƒãƒ‰ã§è³¼èª­ã§ãã‚‹ã‚¤ãƒ™ãƒ³ãƒˆã§ã™ï¼š</p>
    <table>
        <thead>
            <tr>
                <th>ã‚¤ãƒ™ãƒ³ãƒˆå</th>
                <th>ãƒ‡ãƒ¼ã‚¿</th>
                <th>èª¬æ˜</th>
            </tr>
        </thead>
        <tbody>
            <tr>
                <td>battle-started</td>
                <td>{'{ party, enemies }'}</td>
                <td>æˆ¦é—˜ãŒé–‹å§‹ã•ã‚ŒãŸã¨ã</td>
            </tr>
            <tr>
                <td>turn-started</td>
                <td>{'{ turnNumber, turnOrder }'}</td>
                <td>ã‚¿ãƒ¼ãƒ³ãŒé–‹å§‹ã•ã‚ŒãŸã¨ã</td>
            </tr>
            <tr>
                <td>action-executed</td>
                <td>{'{ action, result }'}</td>
                <td>è¡Œå‹•ãŒå®Ÿè¡Œã•ã‚ŒãŸã¨ã</td>
            </tr>
            <tr>
                <td>battle-ended</td>
                <td>{'{ result, rewards }'}</td>
                <td>æˆ¦é—˜ãŒçµ‚äº†ã—ãŸã¨ã</td>
            </tr>
            <tr>
                <td>animation-started</td>
                <td>{'{ animation }'}</td>
                <td>ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãŒé–‹å§‹ã•ã‚ŒãŸã¨ã</td>
            </tr>
            <tr>
                <td>animation-completed</td>
                <td>{'{ animation }'}</td>
                <td>ã‚¢ãƒ‹ãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ãŒå®Œäº†ã—ãŸã¨ã</td>
            </tr>
            <tr>
                <td>message-added</td>
                <td>{'{ message }'}</td>
                <td>ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ãŒè¿½åŠ ã•ã‚ŒãŸã¨ã</td>
            </tr>
        </tbody>
    </table>
    
    <h3>æˆ¦é—˜ãƒ•ãƒ­ãƒ¼</h3>
    <p>BattleControllerã¯ä»¥ä¸‹ã®æµã‚Œã§æˆ¦é—˜ã‚’é€²è¡Œã—ã¾ã™ï¼š</p>
    <div class="flow-diagram">
        <div class="flow-step">
            <div class="flow-node flow-start">æˆ¦é—˜é–‹å§‹<br/><code>startBattle()</code></div>
            <div class="flow-arrow">â†“</div>
        </div>
        <div class="flow-step">
            <div class="flow-node">ã‚³ãƒãƒ³ãƒ‰å…¥åŠ›å¾…ã¡<br/><code>selectCommand()</code></div>
            <div class="flow-arrow">â†“</div>
        </div>
        <div class="flow-step">
            <div class="flow-node">ã‚¿ãƒ¼ãƒ³å®Ÿè¡Œ<br/><code>executeTurn()</code></div>
            <div class="flow-arrow">â†“</div>
        </div>
        <div class="flow-step">
            <div class="flow-node flow-decision">å‹æ•—åˆ¤å®š</div>
            <div class="flow-branch">
                <div class="flow-arrow-branch">
                    <span class="branch-label">æˆ¦é—˜ç¶™ç¶š</span>
                    <div class="arrow-back">â†‘</div>
                </div>
                <div class="flow-arrow-branch">
                    <span class="branch-label">æˆ¦é—˜çµ‚äº†</span>
                    <div class="arrow-down">â†“</div>
                </div>
            </div>
        </div>
        <div class="flow-step">
            <div class="flow-node flow-end">çµ‚äº†</div>
        </div>
    </div>

    <h3>ãƒ•ãƒ­ãƒ¼åˆ¶å¾¡ã®é–¢æ•°</h3>
    <p>æˆ¦é—˜ã®æµã‚Œã‚’å¤‰æ›´ã™ã‚‹ãŸã‚ã«ä»¥ä¸‹ã®é–¢æ•°ã‚’ä½¿ç”¨ã§ãã¾ã™ï¼š</p>
    <ul>
        <li><code>startBattle(party, enemies)</code> - æˆ¦é—˜ã‚’é–‹å§‹</li>
        <li><code>selectCommand(actorId, command)</code> - ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®è¡Œå‹•ã‚’é¸æŠ</li>
        <li><code>executeTurn()</code> - é¸æŠã•ã‚ŒãŸè¡Œå‹•ã‚’å®Ÿè¡Œ</li>
        <li><code>endBattle(result)</code> - æˆ¦é—˜ã‚’å¼·åˆ¶çµ‚äº†</li>
        <li><code>pause()</code> - æˆ¦é—˜ã‚’ä¸€æ™‚åœæ­¢</li>
        <li><code>resume()</code> - ä¸€æ™‚åœæ­¢ã—ãŸæˆ¦é—˜ã‚’å†é–‹</li>
    </ul>

    <h2 id="service">Service</h2>
    <p>BattleServiceã¯ã€æˆ¦é—˜ã«é–¢é€£ã™ã‚‹é«˜ãƒ¬ãƒ™ãƒ«ãªæ“ä½œã‚’æä¾›ã—ã¾ã™ã€‚</p>
    <pre><code>{`const battleService = game.services.battle;

// æˆ¦é—˜ã‚’é–‹å§‹
const battleState = battleService.initBattle(party, enemies);

// ãƒ€ãƒ¡ãƒ¼ã‚¸ã‚’è¨ˆç®—
const damage = battleService.calculateDamage(attacker, target, skill);

// è¡Œå‹•é †ã‚’æ±ºå®š
const turnOrder = battleService.determineTurnOrder(participants);`}</code></pre>

    <h2 id="core-engine">Core Engine</h2>
    <p>ç´”ç²‹ãªè¨ˆç®—ãƒ­ã‚¸ãƒƒã‚¯ã‚’æä¾›ã™ã‚‹ã‚¨ãƒ³ã‚¸ãƒ³ã§ã™ã€‚</p>
    <pre><code>{`import { BattleEngine } from 'geasy-kit';

const engine = new BattleEngine(config);

// ãƒ€ãƒ¡ãƒ¼ã‚¸è¨ˆç®—
const damage = engine.calculatePhysicalDamage(attacker, target);
const magicDamage = engine.calculateMagicDamage(attacker, target, spell);

// å‘½ä¸­åˆ¤å®š
const isHit = engine.checkHit(attacker, target);

// ã‚¯ãƒªãƒ†ã‚£ã‚«ãƒ«åˆ¤å®š
const isCritical = engine.checkCritical(attacker, target);`}</code></pre>
</DocsLayout>

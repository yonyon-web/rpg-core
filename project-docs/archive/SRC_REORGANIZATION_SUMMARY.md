# src配下の構成見直し - 要約

## 現状の問題点

### 現在の構造
```
src/
├── character/   ├── combat/    ├── config/    ├── core/
├── craft/       ├── item/      ├── party/     ├── services/ (19ファイル)
├── shop/        ├── status/    ├── system/    ├── types/ (21ファイル)
└── ui/ (37ファイル)
```

**問題**:
- 🔴 14個のディレクトリが平坦に配置 → 階層が見えにくい
- 🔴 services が肥大化（19ファイル） → 分類されていない
- 🔴 types が肥大化（21ファイル） → ドメインが混在
- 🔴 アーキテクチャが不明瞭 → Core/Services/UI の3層が見えない

---

## 4つの提案

### 📊 比較一覧

| 特徴 | 提案1<br>レイヤー優先 | 提案2<br>ドメイン優先 | 提案3<br>ハイブリッド | 提案4<br>最小限 |
|------|---------------------|---------------------|---------------------|----------------|
| アーキテクチャの明確さ | ⭐⭐⭐⭐⭐ | ⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐ |
| ドメインの分かりやすさ | ⭐⭐⭐ | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐ |
| 移行コストの低さ | ⭐⭐ | ⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐⭐ |
| 長期的な保守性 | ⭐⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐⭐⭐ | ⭐⭐ |
| **総合推奨度** | ⭐⭐⭐⭐ | ⭐⭐⭐ | **⭐⭐⭐⭐⭐** | ⭐⭐⭐ |

---

## 🏆 推奨案: 提案3（ハイブリッド構成）

### 変更後の構造

```
src/
│
├── core/                      # 🎯 Core Engine層（数値計算・ルール）
│   ├── combat/                # 戦闘計算
│   ├── character/             # キャラクター計算
│   ├── item/                  # アイテム計算
│   ├── craft/                 # クラフト計算
│   ├── party/                 # パーティ計算
│   ├── status/                # 状態異常計算
│   ├── system/                # システム基盤 (EventBus, GEasyKit, etc.)
│   └── index.ts
│
├── services/                  # 🎯 Service層（操作フロー管理）
│   ├── battle/                # 戦闘サービス
│   │   ├── BattleService.ts
│   │   ├── BattleActionExecutor.ts
│   │   └── CommandService.ts
│   ├── character/             # キャラクターサービス
│   │   ├── JobChangeService.ts
│   │   └── SkillLearnService.ts
│   ├── item/                  # アイテムサービス
│   │   ├── ItemService.ts
│   │   ├── InventoryService.ts
│   │   ├── EquipmentService.ts
│   │   └── ShopService.ts
│   ├── craft/                 # クラフトサービス
│   ├── party/                 # パーティサービス
│   ├── enemy/                 # 敵サービス
│   ├── status/                # 状態異常サービス
│   ├── system/                # システムサービス
│   └── index.ts
│
├── ui/                        # 🎯 Headless UI層（UIコントローラー）
│   ├── core/                  # UIコア機能
│   ├── controllers/           # UIコントローラー
│   │   ├── battle/            # 戦闘UI
│   │   ├── character/         # キャラクターUI
│   │   ├── item/              # アイテムUI
│   │   ├── craft/             # クラフトUI
│   │   ├── party/             # パーティUI
│   │   ├── status/            # 状態異常UI
│   │   └── system/            # システムUI
│   ├── types/                 # UI型定義
│   └── utils/                 # UIユーティリティ
│
├── types/                     # 🎯 共通型定義（ドメイン別）
│   ├── battle/                # 戦闘型
│   ├── character/             # キャラクター型
│   ├── item/                  # アイテム型
│   ├── craft/                 # クラフト型
│   ├── status/                # 状態異常型
│   ├── system/                # システム型
│   ├── core/                  # コア型
│   ├── common.ts              # 共通型
│   └── index.ts
│
├── config/                    # 設定
│   └── defaultConfig.ts
│
└── index.ts                   # エントリポイント
```

### なぜこの案が最適か？

#### ✅ メリット

1. **アーキテクチャが明確**
   - `core/`, `services/`, `ui/` の3層構造が一目瞭然
   - ドキュメントと構造が一致

2. **ドメインも整理**
   - 各層内でドメイン別にグループ化
   - 関連ファイルが見つけやすい

3. **移行コストが低い**
   - 既存ファイルを移動・グループ化するだけ
   - 段階的に実施可能

4. **長期的な保守性**
   - 拡張しやすい構造
   - 新規開発者が理解しやすい

5. **実用的なバランス**
   - 理想と現実のバランスが良い
   - リスクが管理しやすい

#### ⚠️ デメリット（最小限）

1. 一部のインポートパスを更新する必要がある
2. controllers が3階層になる（`ui/controllers/battle/`）

---

## 📋 段階的な移行プラン

### フェーズ1: サービス層のグループ化（最優先）
⏱️ 所要時間: 2-3時間

```
services/ 配下の19ファイルをドメイン別に移動
├── battle/
├── character/
├── item/
└── ...
```

**影響**: サービスをimportしているファイル（主にコントローラー）

---

### フェーズ2: UIコントローラーのグループ化
⏱️ 所要時間: 2-3時間

```
ui/controllers/ 配下の15ファイルをドメイン別に移動
├── battle/
├── character/
├── item/
└── ...
```

**影響**: コントローラーをimportしているファイル（主にテスト）

---

### フェーズ3: 型定義のグループ化
⏱️ 所要時間: 4-6時間

```
types/ 配下の21ファイルをドメイン別に移動
├── battle/
├── character/
├── item/
└── ...
```

**影響**: 型をimportしている全ファイル（**最も影響が大きい**）

---

### フェーズ4: Core Engine層の整理
⏱️ 所要時間: 3-4時間

```
既存ディレクトリを core/ 配下に移動
├── combat/
├── character/
├── item/
└── ...
```

**影響**: Core機能をimportしているファイル（主にサービス）

---

### 📊 合計: 11-16時間（約2営業日）

---

## 🚀 実施手順

1. **準備**
   - [ ] 別ブランチを作成（`refactor/reorganize-src`）
   - [ ] ベースラインテストを実行（`npm test`）
   - [ ] ビルドを確認（`npm run build`）

2. **各フェーズの実施**
   - [ ] フェーズ1: サービス層のグループ化
   - [ ] フェーズ2: UIコントローラーのグループ化
   - [ ] フェーズ3: 型定義のグループ化
   - [ ] フェーズ4: Core Engine層の整理

3. **各フェーズ後の確認**
   - [ ] テスト実行（`npm test`）
   - [ ] ビルド確認（`npm run build`）
   - [ ] コミット
   - [ ] プッシュ

4. **完了後**
   - [ ] 全体テスト
   - [ ] PRレビュー
   - [ ] マージ
   - [ ] ドキュメント更新

---

## 📚 参考資料

- **詳細提案書**: [docs/SRC_REORGANIZATION_PROPOSALS.md](./SRC_REORGANIZATION_PROPOSALS.md)
  - 全4提案の詳細
  - 各提案のメリット・デメリット
  - 具体的なディレクトリ構造
  - 比較表

- **アーキテクチャドキュメント**:
  - [docs/実装要素.md](./実装要素.md)
  - [docs/サービス設計.md](./サービス設計.md)
  - [docs/コアエンジン.md](./コアエンジン.md)

---

## 💡 FAQ

### Q: なぜ提案3が最適？
**A**: アーキテクチャの明確さと移行コストのバランスが最も良いため。段階的に実施でき、リスクが低い。

### Q: 全部を一度に変更する必要がある？
**A**: いいえ。フェーズごとに段階的に実施できます。各フェーズは独立しているため、途中で中断・再開も可能。

### Q: 既存のコードは動き続ける？
**A**: はい。各フェーズ後にテストとビルドを実行し、動作を確認します。破壊的変更は避けます。

### Q: どのくらい時間がかかる？
**A**: 合計11-16時間（約2営業日）。ただし、段階的に実施するため、数週間に分けても可能。

### Q: 他の提案を選ぶことはできる？
**A**: もちろんです。詳細提案書を参照し、プロジェクトに最適な案を選択してください。

---

## 📝 次のアクション

1. ✅ この要約と詳細提案書を確認
2. ⏸️ **決定**: どの提案を採用するか決定
3. ⏸️ **決定**: 移行タイミングの決定
4. ⏸️ **実施**: 段階的移行の開始

---

**作成日**: 2026-01-14  
**ドキュメント**: SRC_REORGANIZATION_SUMMARY.md  
**詳細版**: SRC_REORGANIZATION_PROPOSALS.md

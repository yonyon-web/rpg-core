# è£…å‚™ã‚·ã‚¹ãƒ†ãƒ è¨­è¨ˆ

è£…å‚™ã®å¤‰æ›´ã¨ç®¡ç†ã«é–¢ã™ã‚‹è¨­è¨ˆã€‚Core Engineã€Serviceã€Headless UIã®3å±¤ã§æ§‹æˆã€‚

## ç›®æ¬¡

1. [æ¦‚è¦](#æ¦‚è¦)
2. [Core Engineå±¤](#core-engineå±¤)
3. [Serviceå±¤](#serviceå±¤)
4. [Headless UIå±¤](#headless-uiå±¤)

---

## æ¦‚è¦

### 3å±¤ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Headless UI Layer                  â”‚
â”‚  Controller                         â”‚  â† UIçŠ¶æ…‹ç®¡ç†ã€ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œ
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“ å§”è­²
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Service Layer                      â”‚
â”‚  Service                            â”‚  â† ãƒ“ã‚¸ãƒã‚¹ãƒ­ã‚¸ãƒƒã‚¯
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â†“ å§”è­²
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Core Engine Layer                  â”‚
â”‚  ãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«                          â”‚  â† ç´”ç²‹ãªè¨ˆç®—
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Core Engineå±¤

### ğŸ’ è£…å‚™ãƒ»ã‚¢ã‚¤ãƒ†ãƒ ã«é–¢ã™ã‚‹è¨ˆç®—

#### è£…å‚™ã«é–¢ã™ã‚‹åˆ¤å®šã¨è¨ˆç®—
- è£…å‚™å¯èƒ½æ¡ä»¶ã®åˆ¤å®š
  - ãƒ¬ãƒ™ãƒ«åˆ¶é™
  - ã‚¸ãƒ§ãƒ–åˆ¶é™
  - ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è¦ä»¶
- ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹è£œæ­£ã®è¨ˆç®—
  - æ”»æ’ƒåŠ›ãƒ»é˜²å¾¡åŠ›ã®è£œæ­£
  - å±æ€§è€æ€§ã®ä»˜ä¸
  - ç‰¹æ®ŠåŠ¹æœã®é©ç”¨
- è£…å‚™åŠ¹æœã®é©ç”¨
  - ã‚»ãƒƒãƒˆåŠ¹æœ
  - ã‚¨ãƒ³ãƒãƒ£ãƒ³ãƒˆåŠ¹æœ

#### ã‚¢ã‚¤ãƒ†ãƒ ã«é–¢ã™ã‚‹è¨ˆç®—
- ã‚¢ã‚¤ãƒ†ãƒ ã®åŠ¹æœè¨ˆç®—
  - å›å¾©ã‚¢ã‚¤ãƒ†ãƒ ã®åŠ¹æœé‡
  - ãƒãƒ•ã‚¢ã‚¤ãƒ†ãƒ ã®åŠ¹æœ
  - æˆ¦é—˜ã‚¢ã‚¤ãƒ†ãƒ ã®åŠ¹æœ
- ä½¿ç”¨å¯èƒ½æ¡ä»¶ã®åˆ¤å®š
  - æˆ¦é—˜ä¸­/ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã§ã®ä½¿ç”¨å¯å¦
  - å¯¾è±¡æ¡ä»¶ã®åˆ¤å®š
- ã‚¤ãƒ³ãƒ™ãƒ³ãƒˆãƒªã®æ›´æ–°
  - ã‚¢ã‚¤ãƒ†ãƒ æ•°ã®å¢—æ¸›
  - æ‰€æŒä¸Šé™ã®ãƒã‚§ãƒƒã‚¯


---

## Serviceå±¤

---

## 10. EquipmentService - è£…å‚™å¤‰æ›´ç®¡ç†

### æ¦‚è¦
ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼ã®è£…å‚™å¤‰æ›´ã‚’ç®¡ç†ã€‚è£…å‚™å¯å¦åˆ¤å®šã€è£…å‚™å¤‰æ›´ã€æ¯”è¼ƒæ©Ÿèƒ½ã‚’æä¾›ã€‚

### å…¬é–‹ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹

```typescript
class EquipmentService {
  // è£…å‚™å¯å¦ãƒã‚§ãƒƒã‚¯
  checkEquipmentEligibility(character: Character, equipment: Equipment): EquipmentEligibilityCheck;
  
  // è£…å‚™å¤‰æ›´
  equipItem(character: Character, equipment: Equipment, slot: EquipmentType): EquipResult;
  
  // è£…å‚™è§£é™¤
  unequipItem(character: Character, slot: EquipmentType): UnequipResult;
  
  // è£…å‚™æ¯”è¼ƒ
  compareEquipment(character: Character, currentEquip: Equipment | null, newEquip: Equipment): EquipmentComparison;
}
```

### Core Engine å§”è­²

- `item/equipment.checkEquipmentEligibility()` - è£…å‚™å¯å¦åˆ¤å®š
- `item/equipment.calculateEquipmentBonus()` - è£…å‚™ãƒœãƒ¼ãƒŠã‚¹è¨ˆç®—
- `item/equipment.compareEquipment()` - è£…å‚™æ¯”è¼ƒ
- `character/stats.calculateFinalStats()` - æœ€çµ‚ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å†è¨ˆç®—

### å®Ÿè£…ä¾‹

```typescript
class EquipmentService {
  constructor(private coreEngine: CoreEngine) {}
  
  checkEquipmentEligibility(character: Character, equipment: Equipment): EquipmentEligibilityCheck {
    // Core Engineã§è£…å‚™å¯å¦åˆ¤å®š
    return this.coreEngine.checkEquipmentEligibility(character, equipment);
  }
  
  equipItem(character: Character, equipment: Equipment, slot: EquipmentType): EquipResult {
    // è£…å‚™å¯å¦ãƒã‚§ãƒƒã‚¯
    const eligibility = this.checkEquipmentEligibility(character, equipment);
    if (!eligibility.canEquip) {
      return {
        success: false,
        message: `è£…å‚™ã§ãã¾ã›ã‚“: ${eligibility.reason}`,
        reasons: eligibility.reasons
      };
    }
    
    // ç¾åœ¨ã®è£…å‚™ã‚’å–å¾—
    const currentEquipment = character.equipment[slot];
    
    // è£…å‚™å¤‰æ›´
    character.equipment[slot] = equipment;
    
    // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å†è¨ˆç®—
    const previousStats = { ...character.stats };
    character.stats = this.coreEngine.calculateFinalStats(character);
    
    // ã‚¤ãƒ³ãƒ™ãƒ³ãƒˆãƒªã®ãƒ•ãƒ©ã‚°æ›´æ–°
    if (equipment.inventorySlotIndex !== undefined) {
      // equipment.isEquipped = true;
    }
    if (currentEquipment && currentEquipment.inventorySlotIndex !== undefined) {
      // currentEquipment.isEquipped = false;
    }
    
    return {
      success: true,
      message: `${equipment.name}ã‚’è£…å‚™ã—ã¾ã—ãŸ`,
      equippedItem: equipment,
      unequippedItem: currentEquipment,
      statChanges: {
        attack: character.stats.attack - previousStats.attack,
        defense: character.stats.defense - previousStats.defense,
        magicAttack: character.stats.magicAttack - previousStats.magicAttack,
        magicDefense: character.stats.magicDefense - previousStats.magicDefense,
        speed: character.stats.speed - previousStats.speed
      }
    };
  }
  
  unequipItem(character: Character, slot: EquipmentType): UnequipResult {
    const currentEquipment = character.equipment[slot];
    if (!currentEquipment) {
      return {
        success: false,
        message: 'è£…å‚™ã•ã‚Œã¦ã„ã¾ã›ã‚“'
      };
    }
    
    // è£…å‚™è§£é™¤
    character.equipment[slot] = null;
    
    // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹å†è¨ˆç®—
    const previousStats = { ...character.stats };
    character.stats = this.coreEngine.calculateFinalStats(character);
    
    // ã‚¤ãƒ³ãƒ™ãƒ³ãƒˆãƒªã®ãƒ•ãƒ©ã‚°æ›´æ–°
    if (currentEquipment.inventorySlotIndex !== undefined) {
      // currentEquipment.isEquipped = false;
    }
    
    return {
      success: true,
      message: `${currentEquipment.name}ã‚’å¤–ã—ã¾ã—ãŸ`,
      unequippedItem: currentEquipment,
      statChanges: {
        attack: character.stats.attack - previousStats.attack,
        defense: character.stats.defense - previousStats.defense,
        magicAttack: character.stats.magicAttack - previousStats.magicAttack,
        magicDefense: character.stats.magicDefense - previousStats.magicDefense,
        speed: character.stats.speed - previousStats.speed
      }
    };
  }
  
  compareEquipment(character: Character, currentEquip: Equipment | null, newEquip: Equipment): EquipmentComparison {
    // Core Engineã§è£…å‚™æ¯”è¼ƒ
    return this.coreEngine.compareEquipment(character, currentEquip, newEquip);
  }
}
```



---

## Headless UIå±¤

---

## 5. EquipmentController - è£…å‚™å¤‰æ›´UIåˆ¶å¾¡

### çŠ¶æ…‹å®šç¾©

```typescript
interface EquipmentUIState {
  // å¯¾è±¡ã‚­ãƒ£ãƒ©ã‚¯ã‚¿ãƒ¼
  character: Character | null;
  
  // é¸æŠæ®µéš
  stage: 'selecting-slot' | 'selecting-equipment' | 'confirming' | 'completed';
  
  // ã‚¹ãƒ­ãƒƒãƒˆ
  selectedSlot: EquipmentType | null;
  availableSlots: EquipmentType[];
  currentEquipment: Map<EquipmentType, Equipment | null>;
  
  // è£…å‚™ä¸€è¦§
  availableEquipment: Equipment[];
  selectedEquipment: Equipment | null;
  
  // æ¯”è¼ƒãƒ»ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼
  comparison: EquipmentComparison | null;
  previewStats: Stats | null;
  
  // ã‚«ãƒ¼ã‚½ãƒ«
  cursorIndex: number;
  
  // çµæœ
  result: EquipResult | null;
}

interface EquipmentComparison {
  slot: EquipmentType;
  current: Equipment | null;
  new: Equipment;
  statDifferences: {
    [key: string]: number; // 'attack': +10, 'defense': -5, etc.
  };
  betterStats: string[];
  worseStats: string[];
}

interface EquipResult {
  success: boolean;
  character: Character;
  slot: EquipmentType;
  equipped: Equipment | null;
  unequipped: Equipment | null;
  newStats: Stats;
}
```

### ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ©ãƒ¼å®Ÿè£…

```typescript
type EquipmentEvents = {
  'slot-selected': { slot: EquipmentType };
  'equipment-selected': { equipment: Equipment };
  'equipment-equipped': { result: EquipResult };
  'equipment-unequipped': { slot: EquipmentType };
  'cancelled': {};
};

class EquipmentController {
  private state: ObservableState<EquipmentUIState>;
  private events: EventEmitter<EquipmentEvents>;
  private service: EquipmentService;
  private equipmentSlotConfig: EquipmentType[];
  
  constructor(service: EquipmentService, equipmentSlotConfig: EquipmentType[]) {
    this.service = service;
    // è£…å‚™ã‚¹ãƒ­ãƒƒãƒˆæ§‹æˆã¯ Core Engine ã‹ã‚‰å–å¾—ã™ã‚‹ã“ã¨ï¼ˆå¿…é ˆï¼‰
    // è£…å‚™ã‚¹ãƒ­ãƒƒãƒˆæ§‹æˆã®è©³ç´°ã¯ CORE_ENGINE_EXTENSIBILITY.md ã®ã€Œè£…å‚™ã‚¹ãƒ­ãƒƒãƒˆæ§‹æˆã€ã‚’å‚ç…§
    this.equipmentSlotConfig = equipmentSlotConfig;
    
    this.state = new ObservableState<EquipmentUIState>({
      character: null,
      stage: 'selecting-slot',
      selectedSlot: null,
      availableSlots: [],
      currentEquipment: new Map(),
      availableEquipment: [],
      selectedEquipment: null,
      comparison: null,
      previewStats: null,
      cursorIndex: 0,
      result: null
    });
    this.events = new EventEmitter<EquipmentEvents>();
  }
  
  subscribe(listener: (state: EquipmentUIState) => void): () => void {
    return this.state.subscribe(listener);
  }
  
  on<K extends keyof EquipmentEvents>(
    event: K,
    listener: (data: EquipmentEvents[K]) => void
  ): () => void {
    return this.events.on(event, listener);
  }
  
  // è£…å‚™å¤‰æ›´é–‹å§‹
  startEquipmentChange(character: Character): void {
    const availableSlots = this.getAvailableSlots(character);
    const currentEquipment = this.getCurrentEquipment(character);
    
    this.state.setState({
      character,
      stage: 'selecting-slot',
      selectedSlot: null,
      availableSlots,
      currentEquipment,
      availableEquipment: [],
      selectedEquipment: null,
      comparison: null,
      previewStats: null,
      cursorIndex: 0,
      result: null
    });
  }
  
  // ã‚¹ãƒ­ãƒƒãƒˆé¸æŠ
  selectSlot(slot: EquipmentType): void {
    const character = this.state.getState().character!;
    
    // ãã®ã‚¹ãƒ­ãƒƒãƒˆã«è£…å‚™å¯èƒ½ãªè£…å‚™ã‚’å–å¾—
    const availableEquipment = this.service.getEquipableItems(character, slot);
    
    this.state.setState(prev => ({
      ...prev,
      stage: 'selecting-equipment',
      selectedSlot: slot,
      availableEquipment,
      cursorIndex: 0
    }));
    
    this.events.emit('slot-selected', { slot });
  }
  
  // è£…å‚™é¸æŠ
  selectEquipment(equipment: Equipment): void {
    const character = this.state.getState().character!;
    const slot = this.state.getState().selectedSlot!;
    const currentEquip = this.state.getState().currentEquipment.get(slot);
    
    // è£…å‚™æ¯”è¼ƒã‚’ä½œæˆ
    const comparison = this.service.compareEquipment(character, currentEquip || null, equipment);
    
    // ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ã‚’ä½œæˆ
    const previewStats = this.calculatePreviewStats(character, slot, equipment);
    
    this.state.setState(prev => ({
      ...prev,
      selectedEquipment: equipment,
      comparison: comparison as EquipmentComparison,
      previewStats
    }));
    
    this.events.emit('equipment-selected', { equipment });
  }
  
  // è£…å‚™ç¢ºå®š
  async equipItem(): Promise<void> {
    const character = this.state.getState().character!;
    const slot = this.state.getState().selectedSlot!;
    const equipment = this.state.getState().selectedEquipment!;
    
    this.state.setState(prev => ({
      ...prev,
      stage: 'confirming'
    }));
    
    const result = this.service.equipItem(character, equipment, slot);
    
    this.state.setState(prev => ({
      ...prev,
      stage: 'completed',
      result: result as EquipResult,
      currentEquipment: this.getCurrentEquipment(character)
    }));
    
    this.events.emit('equipment-equipped', { result: result as EquipResult });
  }
  
  // è£…å‚™è§£é™¤
  async unequipItem(slot: EquipmentType): Promise<void> {
    const character = this.state.getState().character!;
    
    this.service.unequipItem(character, slot);
    
    this.state.setState(prev => ({
      ...prev,
      currentEquipment: this.getCurrentEquipment(character),
      stage: 'selecting-slot'
    }));
    
    this.events.emit('equipment-unequipped', { slot });
  }
  
  // ã‚«ãƒ¼ã‚½ãƒ«ç§»å‹•
  moveCursor(delta: number): void {
    const currentState = this.state.getState();
    let maxIndex = 0;
    
    if (currentState.stage === 'selecting-slot') {
      maxIndex = currentState.availableSlots.length - 1;
    } else if (currentState.stage === 'selecting-equipment') {
      maxIndex = currentState.availableEquipment.length - 1;
    }
    
    const newIndex = Math.max(0, Math.min(maxIndex, currentState.cursorIndex + delta));
    
    this.state.setState(prev => ({
      ...prev,
      cursorIndex: newIndex
    }));
  }
  
  // ã‚­ãƒ£ãƒ³ã‚»ãƒ«
  cancel(): void {
    const currentState = this.state.getState();
    
    if (currentState.stage === 'selecting-equipment') {
      // ã‚¹ãƒ­ãƒƒãƒˆé¸æŠã«æˆ»ã‚‹
      this.state.setState(prev => ({
        ...prev,
        stage: 'selecting-slot',
        selectedSlot: null,
        selectedEquipment: null,
        comparison: null,
        previewStats: null,
        cursorIndex: 0
      }));
    } else {
      // å®Œå…¨ã«ã‚­ãƒ£ãƒ³ã‚»ãƒ«
      this.events.emit('cancelled', {});
    }
  }
  
  // ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£
  private getAvailableSlots(character: Character): EquipmentType[] {
    // è¨­å®šã•ã‚ŒãŸã‚¹ãƒ­ãƒƒãƒˆæ§‹æˆã‚’ä½¿ç”¨
    // Characterã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰å‹•çš„ã«å–å¾—ã™ã‚‹å®Ÿè£…ã‚‚å¯èƒ½
    return [...this.equipmentSlotConfig];
  }
  
  private getCurrentEquipment(character: Character): Map<EquipmentType, Equipment | null> {
    const equipmentMap = new Map<EquipmentType, Equipment | null>();
    
    // è¨­å®šã•ã‚ŒãŸã‚¹ãƒ­ãƒƒãƒˆã«åŸºã¥ã„ã¦è£…å‚™ã‚’å–å¾—
    for (const slotType of this.equipmentSlotConfig) {
      // character.equipmentã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‹ã‚‰å‹•çš„ã«ã‚¢ã‚¯ã‚»ã‚¹
      const equipment = character.equipment[slotType as string] || null;
      equipmentMap.set(slotType, equipment);
    }
    
    return equipmentMap;
  }
  
  private calculatePreviewStats(character: Character, slot: EquipmentType, newEquipment: Equipment): Stats {
    // Serviceã‚’é€šã˜ã¦æ–°ã—ã„ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚’è¨ˆç®—
    return this.service.calculateStatsWithEquipment(character, slot, newEquipment);
  }
}
```

### ä½¿ç”¨ä¾‹ï¼ˆReactï¼‰

```typescript
// æ¨å¥¨: Core Engineã‹ã‚‰è£…å‚™ã‚¹ãƒ­ãƒƒãƒˆæ§‹æˆã‚’å–å¾—
function EquipmentScreen({ character, coreEngine }: { 
  character: Character; 
  coreEngine: CoreEngine;
}) {
  const [state, setState] = useState<EquipmentUIState>();
  const controllerRef = useRef<EquipmentController>();
  
  useEffect(() => {
    const service = new EquipmentService(coreEngine);
    
    // Core Engineã‹ã‚‰è£…å‚™ã‚¹ãƒ­ãƒƒãƒˆæ§‹æˆã‚’å–å¾—ï¼ˆæ¨å¥¨ï¼‰
    const equipmentSlots = coreEngine.getEquipmentSlots();
    const controller = new EquipmentController(service, equipmentSlots);
    
    controllerRef.current = controller;
    const unsubscribe = controller.subscribe(setState);
    controller.startEquipmentChange(character);
    
    return unsubscribe;
  }, [character, coreEngine]);
  
  if (!state) return <div>Loading...</div>;
  
  return (
    <div className="equipment-screen">
      <CharacterStats character={state.character!} previewStats={state.previewStats} />
      
      {state.stage === 'selecting-slot' && (
        <EquipmentSlotList
          slots={state.availableSlots}
          currentEquipment={state.currentEquipment}
          cursorIndex={state.cursorIndex}
          onSelectSlot={(slot) => controllerRef.current?.selectSlot(slot)}
          onUnequip={(slot) => controllerRef.current?.unequipItem(slot)}
        />
      )}
      
      {state.stage === 'selecting-equipment' && (
        <>
          <EquipmentList
            equipment={state.availableEquipment}
            cursorIndex={state.cursorIndex}
            onSelectEquipment={(eq) => controllerRef.current?.selectEquipment(eq)}
          />
          
          {state.comparison && (
            <EquipmentComparison comparison={state.comparison} />
          )}
        </>
      )}
    </div>
  );
}

// å¾Œæ–¹äº’æ›: ExtensibleConfigã‹ã‚‰è£…å‚™ã‚¹ãƒ­ãƒƒãƒˆæ§‹æˆã‚’å–å¾—ã™ã‚‹ä¾‹
function EquipmentScreenWithConfig({ character, coreEngine }: { 
  character: Character; 
  coreEngine: ExtensibleCoreEngine;
}) {
  const [state, setState] = useState<EquipmentUIState>();
  const controllerRef = useRef<EquipmentController>();
  
  useEffect(() => {
    const service = new EquipmentService(coreEngine);
    
    // Core Engineã®æ‹¡å¼µè¨­å®šã‹ã‚‰è£…å‚™ã‚¹ãƒ­ãƒƒãƒˆã‚’å–å¾—
    // CORE_ENGINE_EXTENSIBILITY.mdã§å®šç¾©ã•ã‚ŒãŸæ§‹æˆã‚’ä½¿ç”¨
    const equipmentSlots = coreEngine.getEquipmentSlots();
    const controller = new EquipmentController(service, equipmentSlots);
    
    controllerRef.current = controller;
    const unsubscribe = controller.subscribe(setState);
    controller.startEquipmentChange(character);
    
    return unsubscribe;
  }, [character, coreEngine]);
  
  // ... rest of the component
}

// ãƒ—ãƒªã‚»ãƒƒãƒˆæ§‹æˆã‚’ä½¿ç”¨ã™ã‚‹ä¾‹ï¼ˆãƒ†ã‚¹ãƒˆã‚„ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ç”¨ï¼‰
function EquipmentScreenWithPreset({ character, presetName }: { 
  character: Character; 
  presetName: 'simple' | 'advanced' | 'action-rpg' | 'minimal';
}) {
  const [state, setState] = useState<EquipmentUIState>();
  const controllerRef = useRef<EquipmentController>();
  
  useEffect(() => {
    const service = new EquipmentService(coreEngine);
    
    // CORE_ENGINE_EXTENSIBILITY.mdã§å®šç¾©ã•ã‚ŒãŸãƒ—ãƒªã‚»ãƒƒãƒˆã‚’ä½¿ç”¨
    const equipmentConfigPresets = {
      'simple': ['weapon', 'armor', 'shield', 'accessory'],
      'advanced': ['weapon', 'offhand', 'head', 'body', 'arms', 'accessory1', 'accessory2'],
      'action-rpg': ['mainWeapon', 'subWeapon', 'armor', 'charm'],
      'minimal': ['weapon', 'armor', 'accessory']
    };
    
    const equipmentSlots = equipmentConfigPresets[presetName];
    const controller = new EquipmentController(service, equipmentSlots);
    
    controllerRef.current = controller;
    const unsubscribe = controller.subscribe(setState);
    controller.startEquipmentChange(character);
    
    return unsubscribe;
  }, [character, presetName]);
  
  // ... rest of the component
}
```

**è£…å‚™ã‚¹ãƒ­ãƒƒãƒˆæ§‹æˆã«ã¤ã„ã¦**:
- **æ¨å¥¨**: Core Engineã® `getEquipmentSlots()` ãƒ¡ã‚½ãƒƒãƒ‰ã‚’ä½¿ç”¨ã—ã¦ã‚¹ãƒ­ãƒƒãƒˆæ§‹æˆã‚’å–å¾—
- ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆæ§‹æˆã¯ Core Engine å´ã§å®šç¾©ï¼ˆ`DEFAULT_EQUIPMENT_SLOTS`ï¼‰
- è£…å‚™ã‚¹ãƒ­ãƒƒãƒˆã®å®šç¾©æ–¹æ³•ã«ã¤ã„ã¦ã¯ `CORE_ENGINE_EXTENSIBILITY.md` ã®ã€Œè£…å‚™ã‚¹ãƒ­ãƒƒãƒˆæ§‹æˆã€ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚’å‚ç…§
- ã‚²ãƒ¼ãƒ ã”ã¨ã«è‡ªç”±ã«ã‚¹ãƒ­ãƒƒãƒˆæ§‹æˆã‚’å®šç¾©å¯èƒ½
- ãƒ—ãƒªã‚»ãƒƒãƒˆæ§‹æˆï¼ˆsimple, advanced, action-rpg, minimalï¼‰ã‚’åˆ©ç”¨å¯èƒ½


